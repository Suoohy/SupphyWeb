<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>CanlÄ± Destek Widget</title>
<style>
  /* Buton stil */
  #chat-button {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #4fc3f7;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    border: none;
    cursor: pointer;
    font-size: 30px;
    color: #000;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }

  /* Chat kutusu gizli baÅŸlangÄ±Ã§ta */
  #chat-box {
    position: fixed;
    bottom: 90px;
    right: 20px;
    width: 320px;
    max-height: 400px;
    background: #222;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    display: none;
    flex-direction: column;
    overflow: hidden;
  }

  #chat-header {
    background: #4fc3f7;
    padding: 10px;
    color: #000;
    font-weight: bold;
  }

  #chat-messages {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    color: #fff;
  }

  #chat-input-container {
    display: flex;
    padding: 10px;
    background: #111;
  }

  #chat-input {
    flex-grow: 1;
    border-radius: 10px;
    border: none;
    padding: 8px 12px;
    font-size: 14px;
  }

  #send-btn {
    background: #4fc3f7;
    border: none;
    color: #000;
    font-weight: bold;
    padding: 8px 12px;
    margin-left: 8px;
    border-radius: 10px;
    cursor: pointer;
  }

  .message {
    margin-bottom: 10px;
    padding: 8px 12px;
    border-radius: 12px;
    max-width: 70%;
    word-wrap: break-word;
  }
  .sent {
    background: #4fc3f7;
    color: #000;
    margin-left: auto;
  }
  .received {
    background: #444;
    color: #fff;
    margin-right: auto;
  }
</style>
</head>
<body>

<button id="chat-button">ðŸ’¬</button>

<div id="chat-box">
  <div id="chat-header">CanlÄ± Destek</div>
  <div id="chat-messages"></div>
  <div id="chat-input-container">
    <input type="text" id="chat-input" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n..." />
    <button id="send-btn">GÃ¶nder</button>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // Firebase configini kendi projenle deÄŸiÅŸtir
  const firebaseConfig = {
    apiKey: "API_KEYÄ°NÄ°Z",
    authDomain: "PROJECT_ID.firebaseapp.com",
    projectId: "PROJECT_ID",
    storageBucket: "PROJECT_ID.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const chatButton = document.getElementById('chat-button');
  const chatBox = document.getElementById('chat-box');
  const chatMessages = document.getElementById('chat-messages');
  const chatInput = document.getElementById('chat-input');
  const sendBtn = document.getElementById('send-btn');

  let currentUser;

  // Butona tÄ±klayÄ±nca chat kutusunu aÃ§/kapa
  chatButton.onclick = () => {
    if (chatBox.style.display === "flex") {
      chatBox.style.display = "none";
    } else {
      chatBox.style.display = "flex";
    }
  };

  // KullanÄ±cÄ± giriÅŸ kontrolÃ¼
  onAuthStateChanged(auth, user => {
    if (!user) {
      alert("LÃ¼tfen giriÅŸ yapÄ±n!");
      window.location.href = "index.html"; // GiriÅŸ sayfasÄ±
      return;
    }
    currentUser = user;
    listenMessages();
  });

  // MesajlarÄ± dinle ve gÃ¶ster
  function listenMessages() {
    const q = query(collection(db, "chats"), orderBy("timestamp"));
    onSnapshot(q, snapshot => {
      chatMessages.innerHTML = "";
      snapshot.forEach(doc => {
        const msg = doc.data();
        const div = document.createElement('div');
        div.textContent = msg.text;
        div.className = 'message ' + (msg.senderId === currentUser.uid ? 'sent' : 'received');
        chatMessages.appendChild(div);
      });
      chatMessages.scrollTop = chatMessages.scrollHeight;
    });
  }

  // Mesaj gÃ¶nder
  sendBtn.onclick = async () => {
    const text = chatInput.value.trim();
    if (!text) return;
    await addDoc(collection(db, "chats"), {
      senderId: currentUser.uid,
      text: text,
      timestamp: serverTimestamp()
    });
    chatInput.value = "";
  };

  chatInput.addEventListener('keypress', e => {
    if (e.key === 'Enter') sendBtn.onclick();
  });
</script>

</body>
</html>
